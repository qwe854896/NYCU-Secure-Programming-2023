#!/usr/bin/env python3

from secret import FLAG
from os import urandom
from base64 import b64encode, b64decode

from pwn import *
from sage.all import *
from Crypto.Util.number import *

"""
n=11569790413827816933908095533887398462172207256065324129450922012977446842962717020536714951810889242138868815975616743663462560884038296941590187180416405454177529005146445197828700086866520272960589224980261620148723748140621837674327773523483626678761417404123665114047184262338110061598169768518937133283545703938784648165801952227784242840067665239115547008563023699595918311411975000496840027636729958798819753051929461760614679458269578626902767122282540807177301164287440914075731616709236483089065491361265473098348143047879618340436375928844306278950152800151491912299129285817044907726297469769683729256027, e=3
FLAG:  25750487387764454208888166972280006952461741740576875090770855115191805664944931323181147750814535167135216244487057408726228514371779033541608076685663203038870337757012336005791728526758587744553087671256225873506613601340609125
Any message for me?12345
How beautiful the message is, it makes me want to destroy it .w.
New Message:  10723940071068494176867144355761862470514292730967071198821614999281757642618793330462383480307568462877355660866644910503653659369786128993517391243880534404050815490381637461159668706111692978700268912023903200870432594917908286191365389594882866107915551686088739677159421103385315319253856129242517527526179874388167069008933822086394447851922841722907524675767334351145280181335997889900576310901441477906875598696882662384589005786132055394876768314262982858223896599188985784658998549469521576010754455232232605701144009918522758347251572090520358755050717271453502790437634796144897552204439733424384938398951
Any message for me?67890
How beautiful the message is, it makes me want to destroy it .w.
New Message:  5612207887321116124421738221145819599554470214127958342411477444611771432437951779102730363831565255215346589321524122159405499455264185047060937650386408323494381108082606221323856316975618885255295201802077361280134938825995296118612000859514805045461173458293975688598026429730408389236453773243119871732207486467084017664063613197628267236178956043653792114599015892811125331710411722305431999151444426222773879171889210374973370258217401486318727044005988949138275522844946135079323146583870237680242803353396999139278939197849400225668053184071269808998162323216715300020424854894855134022346921459320472851187
Any message for me?12345
How beautiful the message is, it makes me want to destroy it .w.
New Message:  9609354335736379672842680422878279519513374593044072085063629966095546915080796992494756008732811365365141166617361885671908772477822318172467957383754435100768091670994180185647273129546611755245788055886964276299781738352259029662695026251254255098678863826760935551763006524694191532812718251988136872813406271595841262962626886964059846930488512565490896680517467470108284979746177084887179554384177119964993414999057127299082116327117840626149768628528855737062266596305231285012919092302740697423904338056328564494184470377937171239885055339142257476260815517180158764605541845595776048874178450948138111049255
"""


def get_conn():
    # return process(b"./rsa.py")
    return remote("chal1.eof.ais3.org", 10002)


def get_a_pair():
    r = get_conn()
    line = r.recvline()
    # print(line)
    n, e = int(line[:-6].strip().split(b"=")[1]), 3
    # print(n, e)

    line = r.recvline()
    # print(line)
    enc = int(line.strip().split(b" ")[2])
    # print(enc)

    r.close()

    return n, enc


def find_cubic_root(n):
    n = Integer(n)
    l = 0
    r = n
    while l < r:
        mid = Integer((l + r) // 2)
        if mid**3 < Integer(n):
            l = mid + 1
        else:
            r = mid
    return l, l**3 == Integer(n)


rs = []
ms = []

flag_final = b""

while True:
    n, enc = get_a_pair()

    rs.append(Integer(enc))
    ms.append(Integer(n))

    flag3 = CRT_list(rs, ms)
    print(flag3)

    flag, is_cube = find_cubic_root(flag3)

    if is_cube and b"AIS3" in long_to_bytes(flag):
        flag_final = long_to_bytes(flag)
        break


print(flag_final)
